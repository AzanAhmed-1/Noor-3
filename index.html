<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Noor-UL-Ain ‚ù§Ô∏è</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
/* GENERAL STYLES */
body {
    margin: 0;
    padding: 20px;
    font-family: 'Georgia', serif;
    background: linear-gradient(to right, #fdeff9, #ec38bc);
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.hidden { display: none !important; }

/* ADMIN PANEL */
#admin {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    z-index: 1000;
}
textarea {
    width: 100%;
    height: 120px;
    margin-top: 10px;
    padding: 10px;
    box-sizing: border-box;
    font-family: inherit;
}
button {
    background: #ff5e7e;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    margin-top: 10px;
    cursor: pointer;
    font-weight: bold;
}

/* ENVELOPE */
.envelope {
    width: 100%;
    max-width: 320px;
    height: 200px;
    background: white;
    margin-top: 80px;
    border-radius: 10px;
    position: relative;
    cursor: pointer;
    box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    transition: transform 0.3s;
}
.envelope:hover { transform: scale(1.05); }

.stamp {
    position: absolute;
    top: 15px;
    right: 15px;
    border: 2px dashed #ff5e7e;
    padding: 5px 10px;
    font-size: 12px;
    color: #ff5e7e;
    font-weight: bold;
    transform: rotate(15deg);
}

.click-hint {
    margin-top: 20px;
    color: white;
    font-size: 14px;
    opacity: 0.8;
    animation: bounce 2s infinite;
}

/* LETTER CONTAINER */
.letter-container {
    background: white;
    padding: 30px;
    border-radius: 14px;
    max-width: 600px;
    margin-top: 40px;
    text-align: left;
    box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    line-height: 1.8;
    color: #333;
    width: 90%;
    margin-bottom: 40px;
}

h2 { text-align: center; color: #ff5e7e; margin-top: 0; margin-bottom: 30px; }

/* INDIVIDUAL LETTER ENTRY */
.letter-entry {
    border-bottom: 2px dashed #ffcad4;
    padding-bottom: 20px;
    margin-bottom: 30px;
}
.letter-entry:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.letter-text {
    white-space: pre-wrap; /* Keeps your paragraphs */
}

.signature {
    margin-top: 20px;
    text-align: right;
    font-style: italic;
    color: #777;
    font-size: 0.9em;
}

/* ANIMATION */
@keyframes bounce {
    0%, 100% {transform: translateY(0);}
    50% {transform: translateY(-5px);}
}
</style>
</head>

<body>

<div id="admin" class="hidden">
    <h3>üíå Write a New Letter</h3>
    <textarea id="adminText" placeholder="Write your heart out here..."></textarea>
    <br>
    <button onclick="saveLetter()">Save to Diary</button>
    <p id="status" style="font-size:12px; color:gray; margin-top:10px;"></p>
</div>

<div class="envelope" id="envelope" onclick="openLetter()">
    <div class="stamp">For You</div>
</div>
<div class="click-hint" id="hint">Tap to open</div>

<div class="letter-container hidden" id="letterView">
    </div>

<script>
// 1. FIREBASE CONFIGURATION
const firebaseConfig = {
  apiKey: "AIzaSyAcnkbwI7FSYINPoTFkKPHh5qVN6okHrrI",
  authDomain: "noor-3-9c64a.firebaseapp.com",
  projectId: "noor-3-9c64a",
  storageBucket: "noor-3-9c64a.appspot.com",
  messagingSenderId: "883642246934",
  appId: "1:883642246934:web:e9f76efb03016093765237"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// 2. CHECK FOR ADMIN MODE
window.onload = function() {
    if (window.location.hash === "#admin") {
        document.getElementById("admin").classList.remove("hidden");
        document.getElementById("envelope").style.display = "none";
        document.getElementById("hint").style.display = "none";
    }
};

// 3. FETCH & DISPLAY ALL LETTERS
function openLetter() {
    const envelope = document.getElementById("envelope");
    const hint = document.getElementById("hint");
    const letterView = document.getElementById("letterView");

    // Hide envelope, show letter container
    envelope.style.display = "none";
    hint.style.display = "none";
    letterView.classList.remove("hidden");

    // Add Header
    letterView.innerHTML = "<h2>For Noor-UL-Ain ‚ù§Ô∏è</h2>";
    letterView.innerHTML += "<p style='text-align:center; color:gray;'>Loading memories...</p>";

    // Fetch from Firebase
    db.collection("letters")
      .orderBy("timestamp", "desc") // Newest first
      .get()
      .then((querySnapshot) => {
          // Clear "Loading..."
          letterView.innerHTML = "<h2>For Noor-UL-Ain ‚ù§Ô∏è</h2>";

          if (!querySnapshot.empty) {
              querySnapshot.forEach((doc) => {
                  const data = doc.data();
                  
                  // Format Date
                  let dateString = "Unknown Date";
                  if (data.timestamp) {
                      const date = data.timestamp.toDate();
                      dateString = date.toLocaleDateString("en-US", { 
                          year: 'numeric', month: 'long', day: 'numeric' 
                      });
                  }

                  // Create HTML for this letter
                  const letterHTML = `
                    <div class="letter-entry">
                        <div class="letter-text">${data.text}</div>
                        <div class="signature">
                            ‚Äî Azan Ahmed<br>
                            <span>${dateString}</span>
                        </div>
                    </div>
                  `;
                  
                  // Add to page
                  letterView.innerHTML += letterHTML;
              });
          } else {
              letterView.innerHTML += "<p style='text-align:center'>No letters found yet. ‚ù§Ô∏è</p>";
          }
      })
      .catch((error) => {
          console.error("Error:", error);
          letterView.innerHTML += "<p style='text-align:center; color:red'>Error loading letters. Please refresh. ‚ù§Ô∏è</p>";
      });
}

// 4. SAVE A NEW LETTER (ADMIN)
function saveLetter() {
    const text = document.getElementById("adminText").value;
    const status = document.getElementById("status");

    if (!text) {
        alert("Please write something first!");
        return;
    }

    status.innerText = "Saving...";

    db.collection("letters").add({
        text: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        status.innerText = "Saved successfully! Refresh to write another.";
        document.getElementById("adminText").value = "";
    })
    .catch((error) => {
        status.innerText = "Error: " + error.message;
    });
}
</script>

</body>
</html>
