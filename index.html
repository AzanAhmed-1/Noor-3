<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Noor-UL-Ain ‚ù§Ô∏è</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
/* GENERAL STYLES */
body {
    margin: 0;
    padding: 20px;
    font-family: 'Georgia', serif;
    background: linear-gradient(to right, #fdeff9, #ec38bc);
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.hidden { display: none !important; }

/* ADMIN PANEL */
#admin {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    z-index: 1000;
}
textarea {
    width: 100%;
    height: 120px;
    margin-top: 10px;
    padding: 10px;
    box-sizing: border-box;
}
button {
    background: #ff5e7e;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    margin-top: 10px;
    cursor: pointer;
}

/* ENVELOPE */
.envelope {
    width: 100%;
    max-width: 320px;
    height: 200px;
    background: white;
    margin-top: 80px;
    border-radius: 10px;
    position: relative;
    cursor: pointer;
    box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    transition: transform 0.3s;
}
.envelope:hover { transform: scale(1.05); }

.stamp {
    position: absolute;
    top: 15px;
    right: 15px;
    border: 2px dashed #ff5e7e;
    padding: 5px 10px;
    font-size: 12px;
    color: #ff5e7e;
    font-weight: bold;
    transform: rotate(15deg);
}

.click-hint {
    margin-top: 20px;
    color: white;
    font-size: 14px;
    opacity: 0.8;
    animation: bounce 2s infinite;
}

/* LETTER */
.letter {
    background: white;
    padding: 30px;
    border-radius: 14px;
    max-width: 600px;
    margin-top: 40px;
    text-align: left;
    box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    line-height: 1.8;
    color: #333;
    width: 90%;
}

h2 { text-align: center; color: #ff5e7e; margin-top: 0; }
.signature { margin-top: 40px; text-align: right; font-style: italic; color: #555; }

/* ANIMATION */
@keyframes bounce {
    0%, 100% {transform: translateY(0);}
    50% {transform: translateY(-5px);}
}
</style>
</head>

<body>

<div id="admin" class="hidden">
    <h3>üíå Write a New Letter</h3>
    <textarea id="adminText" placeholder="Write your heart out..."></textarea>
    <br>
    <button onclick="saveLetter()">Save to Database</button>
    <p id="status" style="font-size:12px; color:gray;"></p>
</div>

<div class="envelope" id="envelope" onclick="openLetter()">
    <div class="stamp">For You</div>
</div>
<div class="click-hint" id="hint">Tap to open</div>

<div class="letter hidden" id="letterView">
    <h2>For Noor-UL-Ain ‚ù§Ô∏è</h2>
    <p id="letterContent">Loading...</p>
    
    <div class="signature">
        ‚Äî Azan Ahmed<br>
        <span id="letterDate"></span>
    </div>
</div>

<script>
// 2. FIREBASE CONFIGURATION
const firebaseConfig = {
  apiKey: "AIzaSyAcnkbwI7FSYINPoTFkKPHh5qVN6okHrrI",
  authDomain: "noor-3-9c64a.firebaseapp.com",
  projectId: "noor-3-9c64a",
  storageBucket: "noor-3-9c64a.appspot.com",
  messagingSenderId: "883642246934",
  appId: "1:883642246934:web:e9f76efb03016093765237"
};

// Initialize Firebase (Compat Mode)
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// 3. PAGE LOGIC
window.onload = function() {
    // Show Admin Panel if URL has #admin
    if (window.location.hash === "#admin") {
        document.getElementById("admin").classList.remove("hidden");
        document.getElementById("envelope").style.display = "none";
        document.getElementById("hint").style.display = "none";
    }
};

// FUNCTION: Open Envelope & Fetch Latest Letter
function openLetter() {
    const envelope = document.getElementById("envelope");
    const hint = document.getElementById("hint");
    const letterView = document.getElementById("letterView");
    const content = document.getElementById("letterContent");
    const dateSpan = document.getElementById("letterDate");

    // UI Animation
    envelope.style.display = "none";
    hint.style.display = "none";
    letterView.classList.remove("hidden");

    // Fetch from Database
    db.collection("letters")
      .orderBy("timestamp", "desc") // Get the newest one
      .limit(1)
      .get()
      .then((querySnapshot) => {
          if (!querySnapshot.empty) {
              const doc = querySnapshot.docs[0];
              const data = doc.data();
              
              // Set Text
              content.innerText = data.text;
              
              // Set Date (Formatted)
              if (data.timestamp) {
                  const date = data.timestamp.toDate();
                  dateSpan.innerText = date.toLocaleDateString("en-US", { 
                      year: 'numeric', month: 'long', day: 'numeric' 
                  });
              }
          } else {
              content.innerText = "No letters found yet. Check back soon! ‚ù§Ô∏è";
          }
      })
      .catch((error) => {
          console.error("Error loading letter:", error);
          content.innerText = "My love, the internet is weak right now, but know that I love you! ‚ù§Ô∏è (Error loading)";
      });
}

// FUNCTION: Save Letter (Admin Only)
function saveLetter() {
    const text = document.getElementById("adminText").value;
    const status = document.getElementById("status");

    if (!text) return;

    status.innerText = "Saving...";

    db.collection("letters").add({
        text: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        status.innerText = "Saved successfully! Refresh to write another.";
        document.getElementById("adminText").value = "";
    })
    .catch((error) => {
        status.innerText = "Error: " + error.message;
    });
}
</script>

</body>
</html>
