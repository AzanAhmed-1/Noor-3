<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Noor-UL-Ain ‚ù§Ô∏è</title>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
/* GENERAL STYLES */
body {
    margin: 0;
    padding: 20px;
    font-family: 'Georgia', serif;
    background: linear-gradient(to right, #fdeff9, #ec38bc);
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
}

.hidden { display: none !important; }

/* ‚ù§Ô∏è INTRO OVERLAY (CLICK TO START) ‚ù§Ô∏è */
#intro-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fdeff9;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 1s ease;
    cursor: pointer;
}

#intro-heart {
    font-size: 80px;
    animation: heartbeat 1.5s infinite;
}

#intro-text {
    margin-top: 20px;
    color: #ff5e7e;
    font-size: 18px;
    font-weight: bold;
    animation: fadeIn 2s;
}

@keyframes heartbeat {
    0% { transform: scale(1); }
    15% { transform: scale(1.3); }
    30% { transform: scale(1); }
    45% { transform: scale(1.15); }
    60% { transform: scale(1); }
}

/* ADMIN PANEL */
#admin {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    z-index: 1000;
}
textarea { width: 100%; height: 120px; margin-top: 10px; padding: 10px; }
button { background: #ff5e7e; color: white; border: none; padding: 10px 20px; border-radius: 20px; margin-top: 10px; }

/* ENVELOPE */
.envelope {
    width: 100%; max-width: 320px; height: 200px; background: white;
    margin-top: 80px; border-radius: 10px; position: relative;
    cursor: pointer; box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    transition: transform 0.3s;
}
.envelope:hover { transform: scale(1.05); }
.stamp {
    position: absolute; top: 15px; right: 15px; border: 2px dashed #ff5e7e;
    padding: 5px 10px; font-size: 12px; color: #ff5e7e; font-weight: bold; transform: rotate(15deg);
}

.click-hint { margin-top: 20px; color: white; font-size: 14px; opacity: 0.8; animation: bounce 2s infinite; }

/* LETTER CONTAINER */
.letter-container {
    background: white; padding: 30px; border-radius: 14px; max-width: 600px;
    margin-top: 40px; text-align: left; box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    line-height: 1.8; color: #333; width: 90%; margin-bottom: 40px;
}
h2 { text-align: center; color: #ff5e7e; margin-top: 0; margin-bottom: 30px; }
.letter-entry { border-bottom: 2px dashed #ffcad4; padding-bottom: 20px; margin-bottom: 30px; }
.letter-entry:last-child { border-bottom: none; margin-bottom: 0; }
.letter-text { white-space: pre-wrap; }
.signature { margin-top: 20px; text-align: right; font-style: italic; color: #777; font-size: 0.9em; }

@keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-5px);} }
</style>
</head>

<body>

<audio id="bgMusic" loop>
    <source src="dekha_hi_nahi.mp3" type="audio/mpeg">
</audio>

<div id="intro-overlay" onclick="startExperience()">
    <div id="intro-heart">‚ù§Ô∏è</div>
    <div id="intro-text">Tap to enter</div>
</div>

<div id="admin" class="hidden">
    <h3>üíå Write a New Letter</h3>
    <textarea id="adminText" placeholder="Write here..."></textarea><br>
    <button onclick="saveLetter()">Save</button>
    <p id="status" style="font-size:12px; color:gray;"></p>
</div>

<div id="main-content" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center;">
    <div class="envelope" id="envelope" onclick="openLetter()">
        <div class="stamp">For You</div>
    </div>
    <div class="click-hint" id="hint">Tap to open</div>

    <div class="letter-container hidden" id="letterView"></div>
</div>

<script>
// 1. FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyAcnkbwI7FSYINPoTFkKPHh5qVN6okHrrI",
  authDomain: "noor-3-9c64a.firebaseapp.com",
  projectId: "noor-3-9c64a",
  storageBucket: "noor-3-9c64a.appspot.com",
  messagingSenderId: "883642246934",
  appId: "1:883642246934:web:e9f76efb03016093765237"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// 2. START EXPERIENCE (Fixes Music & Animation)
function startExperience() {
    const overlay = document.getElementById("intro-overlay");
    const music = document.getElementById("bgMusic");
    const mainContent = document.getElementById("main-content");

    // Play Music
    music.play().then(() => {
        console.log("Music playing...");
    }).catch(e => console.log("Music error:", e));

    // Fade out overlay
    overlay.style.opacity = "0";
    setTimeout(() => {
        overlay.style.display = "none";
        mainContent.classList.remove("hidden");
    }, 1000);
}

// 3. ADMIN CHECK
window.onload = function() {
    if (window.location.hash === "#admin") {
        document.getElementById("intro-overlay").style.display = "none";
        document.getElementById("admin").classList.remove("hidden");
    }
};

// 4. FETCH LETTERS
function openLetter() {
    document.getElementById("envelope").style.display = "none";
    document.getElementById("hint").style.display = "none";
    const letterView = document.getElementById("letterView");
    letterView.classList.remove("hidden");

    letterView.innerHTML = "<h2>For Noor-UL-Ain ‚ù§Ô∏è</h2><p style='text-align:center'>Loading memories...</p>";

    db.collection("letters").orderBy("timestamp", "desc").get()
    .then((snap) => {
        letterView.innerHTML = "<h2>For Noor-UL-Ain ‚ù§Ô∏è</h2>";
        if(!snap.empty) {
            snap.forEach(doc => {
                const data = doc.data();
                const d = data.timestamp ? data.timestamp.toDate().toLocaleDateString() : "";
                letterView.innerHTML += `
                <div class="letter-entry">
                    <div class="letter-text">${data.text}</div>
                    <div class="signature">‚Äî Azan Ahmed<br><span>${d}</span></div>
                </div>`;
            });
        } else {
            letterView.innerHTML += "<p>No letters yet ‚ù§Ô∏è</p>";
        }
    });
}

// 5. SAVE LETTER
function saveLetter() {
    const text = document.getElementById("adminText").value;
    if(!text) return;
    db.collection("letters").add({
        text: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        document.getElementById("status").innerText = "Saved!";
        document.getElementById("adminText").value = "";
    });
}
</script>

</body>
</html>
